<!DOCTYPE html>
<html th:replace="~{main :: main(~{::title}, ~{}, ~{::ol}, ~{::section}, ~{::script})}" xmlns:th="http://www.thymeleaf.com">
<head>
	<title>Managed Users</title>
</head>
<body>
<ol>
	<li class="breadcrumb-item"><a class="breadcrumb-link" th:href="@{/home}">Home</a></li>
	<li class="breadcrumb-item"><a class="breadcrumb-link" th:href="@{/managed-users}">Managed Users</a></li>
	<li class="breadcrumb-item" th:if="${managedUser.id != null}"><a class="breadcrumb-link active" aria-current="page" th:href="@{/managed-users/{memberId}(memberId=${managedUser.id})}" th:text="${managedUser.firstName}"></a></li>
	<li class="breadcrumb-item" th:if="${managedUser.id == null}"><a class="breadcrumb-link active" aria-current="page" th:href="@{/managed-users}">New</a></li>
</ol>
<section class="container space-1">

	<div class="page-header">
		<h1 class="display-4">Managed users</h1>
	</div>
	<hr>
	
	<div class="row">
		<div class="col-12 col-md-3">
			<ul class="nav nav-pills flex-column bg-white p-3" role="tablist" aria-orientation="vertical">
				<li class="nav-item mx-2 my-1">
					<a class="nav-link" role="tab"
							th:classappend="${managedUser.id == null ? 'show active' : ''}"
							th:href="@{/managed-users/new}">
						<i class="fas fa-user-plus"></i> Create user
					</a>
				</li>
				<li th:each="mu : ${user.managedUsers}" class="nav-item mx-2 my-1">
					<a class="nav-link" role="tab"
						th:classappend="${mu.id == managedUser.id} ? 'show active' : ''"
						th:href="@{/managed-users/{userId}(userId=${mu.id})}"
						th:text="${mu.firstName}"></a>
				</li>
			</ul>
		</div>
		
		<div class="col-12 col-md-9">
			<div class="tab-content bg-white p-3">
				<div class="tab-pane fade show active" th:if="${managedUser.id == null}"
						th:include="secured/new-managed-user :: form">
				</div>
				<div class="tab-pane fade show active" th:if="${managedUser.id != null}">
					<h2 class="pl-2 pb-2 border-bottom"><strong th:text="${managedUser.firstName}"></strong></h2>
					
					<div class="clearfix mb-5">
						<form th:action="@{/managed-users/{userId}/wishlist-description(userId=${managedUser.id})}" method="post">
							<div class="form-group">
								<textarea class="form-control" name="description" placeholder="Wishlist description..." th:text="${managedUser.wishlistDescription}"></textarea>
							</div>
							<button class="btn btn-primary btn-sm transition-3d-hover float-right" type="submit">Update description</button>
						</form>
					</div>
					<div class="clearfix mb-5">
						<h4>Wishes</h4>
						<div class="table-responsive-md u-datatable">
							<table id="wish-table" class="table table-borderless table-stripe u-datatable__striped u-datatable__content">
								<thead>
									<tr class="text-uppercase font-size-1">
										<th scope="col" class="font-weight-medium">
											<div class="d-flex justify-content-between align-items-center">
												Description
											</div>
										</th>
										<th scope="col" class="font-weight-medium">
											<div class="d-flex justify-content-between align-items-center">
												Price
											</div>
										</th>
										<th scope="col" class="font-weight-medium">
											<div class="d-flex justify-content-between align-items-center">
												Show Links
											</div>
										</th>
										<th scope="col" class="font-weight-medium">
											<div class="d-flex justify-content-between align-items-center"></div>
										</th>
									</tr>
								</thead>
								<tbody>
									<!-- Wishes -->
									<tr th:each="wish : ${managedUser.wishes}">
										<td class="align-middle" th:text="${wish.description}"></td>
										<td class="align-middle" th:text="${wish.price != null ? wish.price.currency : 'N/A'}"></td>
										<td class="align-middle">
											<div class="media align-items-center">
												<label class="checkbox-switch">
													<input type="checkbox" class="checkbox-switch__input show-refs" th:attr="data-wish-id=${wish.id}">
													<span class="checkbox-switch__slider"></span>
												</label>
											</div>
										</td>
										<td class="align-middle">
											<div class="dropdown dropright">
												<button class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													<i class="fas fa-ellipsis-v"></i>
												</button>
												<div class="dropdown-menu">
													<a class="dropdown-item wish-action-edit" th:attr="data-wish-id=${wish.id},data-user-id=${managedUser.id}" href="javascript:void(0);" data-toggle="modal" data-target="#edit-wish-modal">Edit</a>
													<div class="dropdown-divider"></div>
													<a class="dropdown-item text-danger wish-action-delete" th:attr="data-wish-id=${wish.id},data-wish-description=${wish.description},data-user-id=${managedUser.id}" href="javascript:void(0);" data-toggle="modal" data-target="#delete-wish-modal">Delete</a>
												</div>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<button type="button" class="btn btn-primary btn-sm transition-3d-hover float-right" data-toggle="modal" data-target="#new-managed-wish-modal"><i class="fas fa-plus small mr-2"></i> Add a wish</button>
					</div>
					
					<!-- Events -->
					<div class="mb-5">
						<h4>Events</h4>
						<div class="row">
							<div class="col-12">
								<div class="table-responsive-md u-datatable">
									<table id="managed-user-event-table" class="table table-borderless table-stripe u-datatable__striped u-datatable__content">
										<thead>
											<tr class="text-uppercase font-size-1">
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Event Title
													</div>
												</th>
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Date
													</div>
												</th>
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Action
													</div>
												</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="event : ${events}" th:if="${event.managedUsers.contains(managedUser)}">
												<td th:text="${event.title}"></td>
												<td th:text="${{event.date}}"></td>
												<td>
													<form th:action="@{/managed-users/{id}/event/remove(id=${managedUser.id})}" method="post">
														<input type="hidden" name="eventId" th:value="${event.id}">
														<button class="btn btn-danger btn-xs">Remove</button>
													</form>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<form th:action="@{/managed-users/{id}/event(id=${managedUser.id})}" method="post">
									<div class="input-group">
										<select id="add-to-event-select" class="custom-select form-control-sm" name="eventId" required>
											<option value="">(Select One)</option>
											<option th:each="event : ${events}" th:if="${!event.managedUsers.contains(managedUser)}"
													th:value="${event.id}" th:text="${event.title}">
											</option>
										</select>
										<div class="input-group-append">
											<button class="btn btn-primary btn-sm">Add to Event</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
					
					<!-- Edit form -->
					<div class="mb-5">
						<h4>User details</h4>
						<form th:action="@{/managed-users/{id}/update(id=${managedUser.id})}" method="post">
							<div class="form-group">
								<label>First name</label>
								<input type="text" class="form-control" name="firstName" th:value="${managedUser.firstName}" required>
							</div>
							<div class="form-group">
								<label>Last name</label>
								<input type="text" class="form-control" name="lastName" th:value="${managedUser.lastName}" required>
							</div>
							<button type="submit" class="btn btn-primary btn-sm">Update</button>
							<button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#delete-managed-user-modal">Delete</button>
						</form>
						<!-- End Edit form -->
					</div>
					
					<!-- Add guardian form -->
					<div class="mb-5">
						<div class="row">
							<div class="col-12">
								<div class="table-responsive-md u-datatable">
									<table id="managed-user-guardian-table" class="table table-borderless table-stripe u-datatable__striped u-datatable__content">
										<thead>
											<tr class="text-uppercase font-size-1">
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Name
													</div>
												</th>
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Email
													</div>
												</th>
												<th scope="col" class="font-weight-medium">
													<div class="d-flex justify-content-between align-items-center">
														Action
													</div>
												</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="guardian : ${guardians}" th:if="${guardian.id != user.id}">
												<td th:text="${guardian.firstName} + ' ' + ${guardian.lastName}"></td>
												<td th:text="${guardian.email}"></td>
												<td>
													<form th:action="@{/managed-users/{id}/user/remove(id=${managedUser.id})}" method="post">
														<input type="hidden" name="userId" th:value="${guardian.id}">
														<button class="btn btn-danger btn-xs">Remove</button>
													</form>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<h4>Guardians</h4>
						<form th:action="@{/managed-users/{id}/user(id=${managedUser.id})}" method="post">
							<div class="form-group">
								<label>Guardian email</label>
								<input type="text" class="form-control" name="email" placeholder="Email" required>
								<small class="form-text text-muted">A guardian will be able to manage this user's information.</small>
							</div>
							<button type="submit" class="btn btn-primary btn-sm transition-3d-hover">Add Guardian</button>
						</form>
						<!-- End Add guardian form -->
					</div>
					
				</div>
			</div>
		</div>
	</div>
	
	<!-- Delete managed user modal -->
	<div class="modal fade" id="delete-managed-user-modal" tabindex="-1" role="dialog" aria-labelledby="delete-managed-user-modal-label" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-body">
					<h5 class="modal-title">Confirm Delete</h5>
					<p>Are you sure you want to delete this managed user?</p>
					<form th:action="@{/managed-users/{id}/delete(id=${managedUser.id})}" method="post">
						<button type="submit" class="btn btn-danger btn-block">Yes, delete <span th:text="${managedUser.firstName}">them</span></button>
					</form>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Edit wish modal -->
	<div class="modal fade" id="edit-wish-modal" tabindex="-1" role="dialog" aria-labelledby="edit-wish-modal-label" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<form th:action="@{/managed-wishes/{userId}/update(userId=${managedUser.id})}" method="post">
					<div class="modal-header">
						<h5 class="modal-title" id="edit-wish-modal-label">Update wish</h5>
						<button type="button" class="close btn btn-round" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="edit-wish-description">Description</label>
							<input id="edit-wish-description" class="form-control" type="text" placeholder="My two front teeth..." name="description" required />
							<input id="edit-wish-description-orig" type="hidden">
						</div>
						<div class="form-group">
							<label for="edit-wish-price">Price</label>
							<div class="input-group input-group round">
								<div class="input-group-prepend">
									<span class="input-group-text">
										<i class="fal fa-dollar-sign"></i>
									</span>
								</div>
								<input id="edit-wish-price" class="form-control" type="text" name="price" placeholder="14.99" />
								<input id="edit-wish-price-orig" type="hidden">
							</div>
							<small id="edit-wish-price-help" class="form-text text-muted">This can be a single amount or a range (e.g. 15-20)</small>
						</div>
					</div>
					<div class="modal-footer">
						<input type="hidden" id="edit-wish-id" name="wishId" /><button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" id="edit-wish-button" class="btn btn-primary" disabled>Save changes</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
	<!-- Delete wish modal -->
	<div class="modal fade" id="delete-wish-modal" tabindex="-1" role="dialog" aria-labelledby="delete-wish-modal-label" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<form th:action="@{/managed-wishes/{userId}/delete(userId=${managedUser.id})}" method="post">
					<div class="modal-header">
						<h5 class="modal-title" id="delete-wish-modal-label">Confirm delete</h5>
						<button type="button" class="close btn btn-round" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<p class="lead">Are you sure you want to delete the wish &quot;<span id="delete-wish-description" class="font-weight-bold"></span>&quot;?</p>
					</div>
					<div class="modal-footer">
						<input type="hidden" id="delete-wish-id" name="wishId" />
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-danger">Delete wish</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
	<!-- New wish modal -->
	<div th:fragment="modal" class="modal fade" id="new-managed-wish-modal" tabindex="-1" role="dialog" aria-labelledby="new-managed-wish-modal-label" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<form th:action="@{/managed-wishes/{userId}(userId=${managedUser.id})}" method="post">
					<div class="modal-header">
						<h5 class="modal-title" id="new-managed-wish-modal-label">Make a wish!</h5>
						<button type="button" class="close btn btn-round" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="new-wish-description">Description</label>
							<input id="new-wish-description" class="form-control" type="text" placeholder="My two front teeth..." name="description" required />
						</div>
						<div class="form-group">
							<label for="new-wish-url">URL</label>
							<input id="new-wish-url" class="form-control" type="text" placeholder="http://www.example.com/two-front-teeth" name="urls" />
						</div>
						<div class="form-group">
							<label for="new-wish-price">Price</label>
							<div class="input-group input-group round">
								<div class="input-group-prepend">
									<span class="input-group-text">
										<i class="fal fa-dollar-sign"></i>
									</span>
								</div>
								<input id="new-wish-price" class="form-control" type="text" name="price" placeholder="14.99" />
							</div>
							<small id="new-wish-price-help" class="form-text text-muted">This can be a single amount or a range (e.g. 15-20)</small>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Add to wishlist</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
</section>

<script type="text/javascript" th:src="@{/js/custom/managed-users.js}"></script>
</body>
</html>
